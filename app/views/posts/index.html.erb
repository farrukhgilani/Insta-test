<div class='container-fluid'>



  <div class="row justify-content-center">

    <div class="col-lg-5 col-sm-12">
      <div class='mt-2 overflow-auto'>
        <%User.all.each do |user|%>
          <% if  user.stories.count > 0 %>

            <% if user == current_user||current_user.followees.include?(user) %>
              <%if user.avatar.attached? %>
                <%= link_to  user_stories_path(user) do %>
                  <%= image_tag user.avatar,  style: 'height:70px; width:70px; object-fit: cover;', class:'rounded-circle story-icon ml-2' %>
                <% end %>
              <%else%>
                <%= image_tag '/default-avatar-profile-icon-vector-social-media-user-symbol-image-default-avatar-profile-icon-vector-social-media-user-symbol-209498286.jpeg',  style: 'height:32px; width:32px; object-fit: cover;', class:'rounded-circle ml-2' %>
              <%end %>
            <% end %>

          <% end %>
        <%end%>
      </div>
      <% User.order('RANDOM()').all.each do |followee|%>
      <% if followee == current_user || current_user.followees.include?(followee) %>
        <% followee.posts.shuffle.each do |p| %>
            <div class="post mt-3 bg-white">

              <div class="w-100">

                <div class="u-name-div mb-1">
                  <%if p.user.avatar.attached? %>
                    <%= image_tag p.user.avatar,  style: 'height:32px; width:32px; object-fit: cover;', class:'rounded-circle' %>
                  <%else%>
                    <%= image_tag '/default-avatar-profile-icon-vector-social-media-user-symbol-image-default-avatar-profile-icon-vector-social-media-user-symbol-209498286.jpeg',  style: 'height:32px; width:32px; object-fit: cover;', class:'rounded-circle' %>
                  <%end %>
                  <%= link_to p.user.username , user_path(p.user) ,class:'text-dark font-weight-bold text-decoration-none'%>
                </div>

                <div style="height: auto" data-ride="carousel">
                  <div class='carousel-inner'>
                    <%= link_to post_path(p) do %>
                      <% p.images.each_with_index do |image, i| %>
                        <div id="myCarousel" class='carousel-item <%= ' active ' if i==0 %>'>
                          <%= image_tag image,  style: 'height:auto; width:100%;' %>
                        </div>
                      <% end %>
                    <% end %>
                  </div>
                </div>

                <div class="pt-1">
                  <span><strong><%= pluralize(p.likes.count,'like')%></strong></span>
                  <span class='ml-2'><strong><%= pluralize(p.comments.count,'Comment')%></strong></span>
                  <br/>
                  <% if p.caption.present? %>
                    <span><b><%= p.user.username %></b> <%= p.caption %> </span>
                  <% end %>
                  <div>

                    <% if Like.where(user_id: current_user.id, post_id: p.id).exists? %>
                      <%= link_to 'Unlike', like_post_path(p), class:'btn btn-sm btn-danger text-white mt-1 mb-1'%>
                    <% else %>
                      <%= link_to 'Like', like_post_path(p), class:'btn btn-sm btn-primary text-white mt-1 mb-1'%>
                    <% end %>


                  </div>
                </div>

              </div>

            </div>

        <% end %>
        <% end %>
      <%end%>
    </div>


    <div class='d-flex flex-column col-lg-3 col-sm-12'>
      <div style='height: 300px' class='post bg-white mt-3 ml-5 w-100 side-div'>

          <div>
            <h5 class='mt-3 text-secondary'>Suggestions For You</h5>
            <% User.all.each do |user| %>
              <div class='m-3'>
                <%if user != current_user %>

                  <% if !current_user.followees.include?(user) %>

                    <%if user.avatar.attached? %>
                      <%= image_tag user.avatar,  style: 'height:32px; width:32px; object-fit: cover;', class:'rounded-circle' %>
                    <%else%>
                      <%= image_tag '/default-avatar-profile-icon-vector-social-media-user-symbol-image-default-avatar-profile-icon-vector-social-media-user-symbol-209498286.jpeg',  style: 'height:32px; width:32px; object-fit: cover;', class:'rounded-circle' %>
                    <%end %>
                    <%= link_to user.username , user_path(user) ,class:'text-dark font-weight-bold text-decoration-none'%>
                    <%if Request.where(sender_id: current_user.id, receiver_id: user.id).exists? %>
                      <%= link_to 'Cancel', cancel_user_path(user), class:'ml-4 btn btn-sm btn-danger text-white float-right' %>
                    <% else %>
                      <%= link_to 'Follow' , follow_user_path(user), method: "POST" ,class:'btn btn-sm btn-primary text-white float-right'%>
                    <% end %>

                  <% end %>
                <% end %>
              </div>
            <% end %>
          </div>

      </div>


      <% if Request.where(receiver_id: current_user.id).exists? %>
        <div style='height: 200px' class='post bg-white mt-3 ml-5 w-100'>
          <div>
            <h5 class='mt-3 text-secondary'>Requests</h5>
              <%User.all.each do |user|%>

                <% if Request.where(sender_id: user.id, receiver_id: current_user.id).exists? %>
                  <div class='m-3'>
                    <%if user.avatar.attached? %>
                      <%= image_tag user.avatar,  style: 'height:32px; width:32px; object-fit: cover;', class:'rounded-circle' %>
                    <%else%>
                      <%= image_tag '/default-avatar-profile-icon-vector-social-media-user-symbol-image-default-avatar-profile-icon-vector-social-media-user-symbol-209498286.jpeg',  style: 'height:32px; width:32px; object-fit: cover;', class:'rounded-circle' %>
                    <%end %>
                    <%= link_to user.username , user_path(user) ,class:'text-dark font-weight-bold text-decoration-none'%>
                    <%= link_to 'Accept' , accept_user_path(user),class:'btn btn-sm btn-warning text-dark float-right'%>
                  </div>

                <% end %>

              <%end%>
          </div>
        </div>
      <% end %>



    </div>
  </div>
</div>
